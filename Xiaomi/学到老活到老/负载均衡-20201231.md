# 负载均衡 (Load Balance)

> 于 2020.12.31周会

<img width="700" src="https://raw.githubusercontent.com/NorthwesternDirector/myGitBook/master/%E5%85%B6%E4%BB%96/%E5%BC%95%E5%85%A5%E5%9B%BE%E7%89%87/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1.png"/>



> ***负载均衡*** 旨在提供一种廉价有效透明的方法，扩展网络设备和服务器的带宽、增加吞吐量、加强网络数据处理能力、提高网络的灵活性和可用性
>
> ⚠️ 本次讨论的内容为常见的三种软件负载均衡技术：`DNS` `LVS` `Nginx`
>
> 分为 L4&L7
>
> L4: 基于IP+端口的负载均衡；L7: 基于URL等应用层信息的负载均衡

## 历史负载均衡技术-基于DNS协议  

### DNS解析原理

[a.b.c.com.] :

依次请求(递归请求&迭代请求)  . (根服务器,受限于UDP包大小只能容纳13个IPV4地址)->.com->.c.com 。。。。

#### 输入

请求类型+域名，

#### 输出

* A *IPV4*

* CNAME *另外一个域名*

  作用：将域名托管给另一个域名，在另一个域名内你随便折腾(小米cdn指向金山cdn，金山再去指向指定ip)

* AAAA *IPV6*

* TTL

* ...

### 基于DNS负载均衡原理

在DNS服务器中支持为多个不同的地址配置相同的域名，也就是说DNS可以将一个域名指向多个IP，哦豁，分出去了 🥰

#### 概念

## LVS (L4)

> 四层负载均衡

虚拟服务器VS  -----均衡分发给-----> 真实服务器RS

L4 四层负载均衡：虚拟服务器始终保持一个TCP链接至一个台真实服务器，

分发规则：`RRround-robin` 轮询，`LCC` 找一个链接数最少的RS ，`WRR` 权重轮询 

DNS解析做到 VS 层级就可以

## Nginx (L7) 

> 七层负载均衡

优点：利用应用层的特征进行一些特殊操作，例如 /api开头的域名分发给后端服务器，其余分发给前端服务器

缺点：涉及到HTTP解析，速度较慢性能较差

## DPDK

...