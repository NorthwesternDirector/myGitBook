# CSS 2.2

> 参考内容 [传送门](https://www.w3.org/TR/CSS22/)

## 4 语法和基本数据类型

###  4.3 值

#### 长度单位

##### 分类

长度单位分为 **相对长度单位** 和 **绝对长度单位** 。相对长度单位会依据另一个长度单位进行计算，在样式中使用相对长度单位更容易去兼容不同设备。

| 相对长度单位 | 绝对长度单位                         |
| ------------ | ------------------------------------ |
| em ex        | 物理单位(in、cm、mm、pt、pc)  px单位 |

* em：相对于当前元素的 font-size 属性计算，如果em作为 font-size 属性的单位使用时，相对于父级的 'font-size' 计算

* ex：相对于小写字母 x  的高度计算
* in：英寸, 1in 等于 2.54cm。
* cm：厘米
* Mm：毫米
* pt：点 (points)，CSS 使用的 points 等于1/72 in
* pc：派卡 (picas)，1pc 等于 12pt
* px：像素 (pixel)，1px 等于 0.75pt（0.26mm）

```css
⚠️：子元素不会继承父元素的相对单位值，而是继承相对单位值计算后得到的计算值（h1为body的子元素）
body {
  font-size: 12px;
  text-indent: 3em;  /* i.e., 36px */
}
h1 { 
	font-size: 15px 
	/*text-indent 为 36px，非 15px*3=45px */
}
```

##### px (CSS pixels) 🌟

###### 前置知识

* 使用值 & 实际值

  `使用值(Used value )` ***原则上就是指用于渲染的值***。但用户在特定设备条件下可能无法渲染出该值，比如设备只能渲染宽度为整数的边框（border），可能因此不得不近似计算宽度，`实际值(Actual values)` 也就是指近似计算后的使用值。

* 设备像素 (device pixel)

  > 设备像素也可以称为物理像素。要与设备独立像素 (device independent pixels)区分：设备独立像素又称“设备无关的逻辑像素”

  显示器上的设备像素（物理像素）等于显示器的点距，而打印机的物理像素等于打印机的墨点。衡量点距大小和打印机墨点大小的单位分别称为 `PPI` 和 `DPI`。

  从下图中可以看到，显示器屏幕实际上是由一个一个"点"组成的（每个"点"又包含3个单位也称三元素组)，**这些"点"就是设备像素**。

  <img src="https://github.com/NorthwesternDirector/myGitBook/blob/master/%E5%85%B6%E4%BB%96/%E5%BC%95%E5%85%A5%E5%9B%BE%E7%89%87/device%20pixel.png?raw=true" width="350"/>

  

  > ⚠️：需要注意的是设备像素是可以"变化"的，当你降低设备分辨率时，一个"点"就需要更多的三元素组来组成，此时"点"的物理尺寸就增大了。例如，原始分辨率为1280×1024的显示器在分辨率为1280×1024时看起来最好，也可以通过用几个物理三元素组来表示一个像素以显示800×600，但可能无法完全显示1600×1200的分辨率，因为物理三元素组不够
  >
  > ⚠️：由于不同的设备屏幕分辨率和尺寸可能不一样，所以设备上设备像素（物理像素）的大小也就不一样。但是对于css来说，它希望在所有的设备上元素的显示效果看起来都是差不多的。那怎么才能让同一元素在不同的设备上显示的效果差不多呢？w3c 提出了一个概念，也就是下面的参考像素(reference pixel)

* 🌟 参考像素 (reference pixel)

  `参考像素 ` 是指在距离96DPI的屏幕一臂距离 (28 inches) 远时，一个像素的可视角度 (0.0213 degrees)。不同观看距离，参考像素的大小不同，它等于这个可视角度在当前观看距离映射在屏幕上的高度。屏幕观看距离为一臂远时，一个参考像素相当于 0.26mm，而当屏幕观看距离为3.5米时，一个参考像素相当于 1.3mm。

  <img src="https://raw.githubusercontent.com/NorthwesternDirector/myGitBook/master/%E5%85%B6%E4%BB%96/%E5%BC%95%E5%85%A5%E5%9B%BE%E7%89%87/reference%20pixel.png" width="350"/>

  🤯：记住参考像素是一个角度！说它的大小时，是指这个角度映射在不同观看距离上的高度值。**一个设备的参考像素由它的典型视距决定，出厂时已经确定**

  在CSS设备中，长度单位要么将物理单位与真实物理测量值对应来标定，要么将像素单位与参考像素对应来标定，对于打印机和类似的高分辨率设备来说，推荐使用标准的物理单位来确定长度；对于低分辨率设备和具有独特观看距离的设备来说，推荐使用像素单位 (pixel unit)来确定长度 ：***🌟 对于低分辨率设备，建议像素单位（CSS pixel）使用最接近参考像素的整数个设备像素（物理像素）***。

  > ⚠️： 如果是用像素单位确定长度，物理单位可能不等于真实物理测量值，或者说，如果是用物理单位确定长度，像素单位可能无法与设备物理像素一一对应
  >
  > ⚠️： 此版本的像素单位和物理单位的定义与以前版本的CSS不同。在以前的CSS版本中（没有参考像素），像素单位和物理单位并没有固定的比例关系：物理单位总是与它们的物理测量值相联系，而像素单位更像是去拟合参考像素。（之所以做出这样的更改是因为之前太多显示内容依赖于96DPI的假设，一但设备不符合96DPI的假设，显示内容也会出问题）

* CSS 像素（CSS pixel）

  > CSS像素 = 设备独立像素 = 逻辑像素 = 代码里写的1px = Chrome调试工具里的1px

  CSS pixel 是 CSS 样式表语言中用来表示长度的一个单位。

  在高分辨率设备下（打印机等），1px就等于96分之一英寸，约等于0.2646mm。此时1px不等于xx个设备像素，px的大小就等于固定值。
  在低分辨率设备下（大部分电脑显示器），像素单位（CSS pixel）的大小等于最接近参考像素的整数个设备像素（物理像素）的大小。此时 pt,cm,in 等单位的大小不等于它的物理大小，它们的大小需要px（这时等于xx个设备像素）来进行转换，如1in此时等于96个设备像素的大小(即96px)

  ```
  举个例子 🌰
  step1. 一个分辨率为1680*1050的22寸电脑显示器，它的参考像素约为0.26mm(这个值的大小由设备的典型视距决定，出厂时已经确定)
  step2. 通过分辨率和尺寸，计算出该显示器的PPI为90.05，此时一个设备像素的值就等于0.28mm。
  step3. 对比这两个值之后发现，1个设备像素的值是最接近参考像素的。所以对于这个设备来说，一个像素单位(1px)就等于一个设备像素
  
  进一步举个例子 🌰
  step1. 一个分辨率为1680*1050的22寸电脑显示器，PPI是90.05，1个设备像素的长度约为0.28mm。这时1个设备像素最接近1个参考像素对应的大小。如果你用css定义了一个盒子宽为375px，此时你用尺子去屏幕上量，会发现375px盒子的实际宽度是0.28(mm) * 375 ≈ 10.5cm
  step2. 调整显示器的分辨率为1024 * 640时，1个设备像素对应的长度是0.46mm，虽然它和参考像素对应的大小有差距，但是没办法，你还得使用它，毕竟它现在就是最接近参考像素大小的整数个设备像素了。上面那个375px的盒子，此时实际的宽度是0.46(mm) * 375 ≈ 17.4cm。所以降低分辨率之后，相同的内容会显得大了。
  step3. 调整显示器的分辨率为1920 * 1080时，1个设备像素对应的长度是0.25mm，此时375px的盒子，实际宽度是0.25(mm * 375 ≈ 9.3cm，所以提高分辨率后，内容自然就变小了。
  ```

参考：[📖](https://zhuanlan.zhihu.com/p/44553199) [📖](https://www.zhihu.com/question/32011095) [📖](https://github.com/jawil/blog/issues/21)

## 8 盒模型

### 8.1 盒子尺寸

盒模型老四样：content、padding、border、margin。看图👇

<img src="https://raw.githubusercontent.com/NorthwesternDirector/myGitBook/master/%E5%85%B6%E4%BB%96/%E5%BC%95%E5%85%A5%E5%9B%BE%E7%89%87/css-box.png" width="400"/>

🤯：用这四个区域的外边界可以定义出：content box / padding box / border box / margin box.

注意：content、padding、border的背景样式由该盒子的 background 属性确定，***margin 的背景色总是透明的***。通常情况下 border 为 solid 且有单独颜色时，background ‘看起来’ 就只能覆盖 content、padding。

### 8.2 `margin`

> 值为百分比时，基于父元素 (containing block) 宽度计算， 'margin-top' & 'margin-bottom' 同样如此。

#### collapse

两个盒子 (不一定是兄弟元素) 的相邻外边距会产生坍缩 (collapse)

* 相邻外边距的条件
  * 两个盒子都是块级元素，并且在相同的块级格式化上下文 (Block formatting contexts)
  * 不是行内元素，没有 <span style="background:yellow"> *clearance* </span> 属性，没有内边距或边框分开它俩
  * 都属于垂直相邻的盒子边框，即：
    * 一个盒子的上外边距和它第一个子盒子的上外边距
    * 一个盒子的下外边距和它紧邻兄弟盒子的上外边距
    * 自动计算高度的盒子的下外边距和它最后一个子盒子的下外边距
    * 一个盒子的上下外边距 (这个盒子没有建立新的块格式化上下文 且 min-height=0 或着 高度为零或自动计算 且 没有子元素)

* 不坍缩的情况	
  * 根元素的外边距不会坍缩 
  * 一个具有 *clearance* 属性的元素的上下外边距相邻，会与紧跟着的兄弟元素的外边距重叠，重叠的这部分不会再与父元素的外边距重叠
  * min-height不为0或自动计算高度的盒子的上外边距和它最后一个子元素的上外边距重叠时，子元素的下外边距不与父元素的下外边距重叠

### 8.3 `padding`

> 值为百分比时，基于父元素 (containing block) 宽度计算， 'padding-top' & 'padding-bottom' 同样如此。

## 9 Visual formatting model

> CSS 视觉格式化模型
>
> 解决目标 👉  ：在不同的终端显示设备上妥善显示（处理）文档树 (document tree) 

在视觉格式化模型中，文档树中的每个元素都会根据盒模型生成零个或多个盒子，这些盒子的布局受以下条件控制：

* 盒子的尺寸和类型
* 定位方式（normal flow、float、absolute position）
* 文档树中元素之间的关系
* 外部信息（视口 (viewport) 大小，图像的固有尺寸等）

### 9.1 Viewport

视窗可以理解为浏览器窗口，当我们改变它的大小时，浏览器会改变文档的布局，并且装不下内容是会自动生成滚动条

#### 9.1.1 Containing blocks

在 css2.2 中，盒子的位置和大小都是根据包含块 (Containing blocks) 的盒子的边缘来计算的,

### 9.2 生成盒子

#### 块级元素&块盒子 

几个概念 🤔 

- ✅ **块级元素** (block-level element)：元素的 display 属性为 block、list-item、table 时，该元素将成为块级元素。元素是否是块级元素仅是元素本身的属性，并不直接用于格式化上下文 (formatting context) 的创建或布局
- **块级盒子** (block-level box)：由块级元素生成。一个块级元素至少会生成一个块级盒子，但也有可能生成多个（例如列表项元素）
- ✅ **块盒子** (block box)：如果一个块级盒子同时也是一个块容器盒子（见下），则称其为块盒子。除具名块盒子之外，还有一类块盒子是匿名的，称为匿名块盒子（Anonymous block box），匿名盒子无法被CSS选择符选中
- **块容器盒子** (block container box / block containing box)：块容器盒子侧重于当前盒子作为“容器”的这一角色，它不参与当前块的布局和定位，它所描述的仅仅是当前盒子与其后代之间的关系。换句话说，块容器盒子主要用于确定其子元素的定位、布局等

#### 匿名块盒子

在某些情况下进行视觉格式化时需要添加一些增补性的盒子，这些盒子不能用CSS选择符选中因此称为匿名盒子（anonymous boxes）

```html
<!-- 此div中同时具有内联内容和块内容，为了使定义格式更加容易css将“Some text”用匿名块级盒子包裹起来 -->
<div>
  Some text 
  <P>More text</P>
</div>
```

生成匿名块盒子的两个场景🤯：

1 如果一个块容器盒子内部有一个块级盒子，则css会强制将内部其它非块级盒子转换为你命块盒子

2 一个行内盒子中包含一或多个块盒子，穿插部位的行内盒子都会被匿名盒子包裹

#### 行内级元素&行内盒子

同样的几个概念 🤔

* ✅ **行内元素** (inline-level element)：如果一个元素的 display 属性为 inline、inline-block 或 inline-table，该元素为行内级元素。

* **行内级盒子** (inline-level box)：由行内级元素生成。该盒子同时会参与行内格式化上下文（inline formatting context）的创建。

* ✅ **行内盒子** (inline box)：内容遵循行内格式化上下文的盒子

⚠️ 行内级盒子和行内盒子是不一样的，行内级盒子又被称为原子行内级盒子，因为行内级盒子会作为单个不透明盒子参与其行内格式化上下文

#### 匿名行内盒子

类似于匿名块盒子，CSS引擎有时候也会自动创建一些匿名行内盒子

生成匿名块盒子的一个场景🤯：

1 直接包含在块盒子内的文本，文本会被一个足够大的匿名行内盒子所包含

#### 短暂思考 🤔

使用频率最高的还是块级盒子&块级元素&行内级元素&行内级盒子，看看CSS3里的最新定义吧，感觉这里有点迷惑行为 🌚

### 9.3 定位方案

* Normal flow
* Floats
* Absolute positioning

### 9.4 Normal flow

Normal flow 在概念上就是以前熟知的“常规流”（文档流）。常规流包括对块级盒子的块格式化、对行内级盒子的行内格式化以及对块级盒子和行内盒子的相对定位。 常规流中所有盒子都会属于某一种格式化上下文，在CSS 2.2中可能是表格、行内、块格式化上下文。 块级盒子会参与块级格式化上下文（BFC）， 行内级盒子会参与行内格式化上下文（IFC）。

通俗理解：***BFC、IFC以及相对定位都不会脱离常规流；而 float和绝对定位会脱离常规流，元素不再属于任何一种格式化上下文🌟***

#### 9.4.1 BFC

> Block formatting contexts 块级格式化上下文

*“BFC 像是生成了块盒子的军事化管理区域，不管你元素的属性如何，进入区域之后，元素都要遵循块盒子的原则，有利于管理”*

概念：BFC 是Web页面的CSS可视化渲染的一部分，是块盒子的布局过程发生的区域，也是浮动元素与其他元素交互的区域。

有些不是块盒子的元素（Floats, absolutely positioned elements, block containers  such as inline-blocks, table-cells, and table-captions）及overflow 属性为除 visible 以外值的块盒子，会为其内容创建一个块级格式化上下文

#### 9.4.2 IFC

> Inline formatting contexts 行内格式化上下文

概念：IFC 也是Web页面的CSS可视化渲染的一部分，行内格式化上下文由不包含块级盒子的块容器盒子生成

🤯：也就是说，在 IFC 的环境中是不能存在块级元素的，如果将块级元素插入到 IFC 中，那么此 IFC 将会被破坏掉变成 BFC，而块级元素前的元素或文本和块级元素后的元素或文本将会各自自动产生一个匿名块盒子将其包围

#### 9.4.3 Relative positioning

### 9.5 Float

### 9.6 Absolute positioning

### 9.7 Relationships between 'display', 'position', and 'float'

直接翻译 5 条规则：

* 当 display: none 时，postion 和 float 失效，这种情况下元素不生成盒子
* 当position: fix / absolute 时，float 的计算值会变为 none，盒子位置由 top、right、bottom、left 及盒子的包含块所决定

* 当 float 不为 none 时，display 的值会像下面表格中的值进行变动
* 根元素，display 的值会像下面表格中的值进行变动
* 其余情况下， display 的其余属性值按指定值显示

| 设定值                                                       | 计算所得值 |
| ------------------------------------------------------------ | ---------- |
| inline-table                                                 | table      |
| inline、inline-block、table-row-group、table-column、table-column-group、table-header-group、 table-footer-group、table-row table-cell、table-caption | block      |
| 其它值                                                       | 同设定值   |

